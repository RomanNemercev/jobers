# Документация по компоненту чата

## Файлы
- **chat-support.html** — разметка чата поддержки и обычного чата, элементы управления, droplist, контейнеры для сообщений и состояния.
- **chat-support.js** — логика сценариев поддержки: первый запрос, выбор темы, отправка первого сообщения, сброс состояния, droplist, переключение между состояниями (new, selected, active, end).
- **chat-script.js** — глобальная логика отправки сообщений для обычного чата, overlay, инициализация состояния.

---

## Основные состояния чата
- **new** — новое обращение, пользователь выбирает тему и вводит сообщение.
- **selected** — тема выбрана, ожидается ввод сообщения.
- **active** — чат активен, можно отправлять обычные сообщения.
- **end** — обращение завершено, можно создать новое.
- **begin** — начальное приветствие.

Состояния управляются через классы на `.chat__timeline-wrapper` и data-атрибут `data-first-message-sent`.

---

## Флаг первого сообщения
- `data-first-message-sent` (на `.chat__timeline-wrapper`):
  - `false` — пользователь ещё не отправил первое обращение (для поддержки).
  - `true` — первое обращение отправлено, можно писать обычные сообщения.
- Для обычного чата флаг сразу `true`, для поддержки — `false` до первого обращения.

---

## Логика работы

### 1. Первый запрос в поддержку
- Пользователь выбирает тему и вводит сообщение.
- После отправки:
  - Сообщение и тема отображаются в чате.
  - Состояние переключается на `active`.
  - Флаг `data-first-message-sent` становится `true`.
  - droplist и поле ввода очищаются.

### 2. Обычный чат
- Сообщения можно отправлять сразу, без выбора темы.
- Флаг `data-first-message-sent` всегда `true`.

### 3. Сброс состояния
- При закрытии чата:
  - Для поддержки: флаг сбрасывается в `false`, droplist сбрасывается.
  - Для обычного чата: флаг остаётся `true`.

### 4. Переключение end → new
- Кнопка "Создать обращение" переводит чат из состояния `end` в `new`.

### 5. Глобальная обработка
- Все проверки состояния и отправки сообщений идут через data-атрибуты DOM, без глобальных переменных.
- Нет конфликтов между chat-support.js и chat-script.js: каждый работает только со "своим" сценарием.

---

## Важно для backend
- Все состояния и сценарии управляются на клиенте через классы и data-атрибуты.
- Для интеграции с backend используйте события отправки сообщений, состояния чата и значения темы/сообщения из DOM.
- Для поддержки корректной работы не меняйте data-атрибуты напрямую через DOM, используйте jQuery `.data()` и при необходимости `.attr()`.

---

Если нужны примеры или расширенная документация по API событий — обратитесь к frontend-разработчику.